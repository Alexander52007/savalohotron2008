{% extends 'base.html' %}
{% block title %}{{ room.name|default:"Личный чат" }} | Чат{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>{{ room.name|default:"Личный чат" }}</h2>
        {% if room.owner == user %}
            <form method="post" action="{% url 'delete_room' room.id %}" style="display:inline;" onsubmit="return confirm('Удалить чат навсегда?');">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger" style="padding: 0.5rem 1rem; font-size: 0.9rem;">
                    Удалить чат
                </button>
            </form>
        {% endif %}
    </div>

    <div style="background: #f8fafc; border-radius: 16px; padding: 20px; min-height: 400px; max-height: 600px; overflow-y: auto; margin-bottom: 24px; box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);">
        {% for msg in messages %}
            <div style="display: flex; margin-bottom: 16px; {% if msg.user == user %}justify-content: flex-end;{% endif %}">
                <div style="
                    background: {% if msg.user == user %}#6366f1{% else %}white{% endif %};
                    color: {% if msg.user == user %}white{% else %}var(--text-primary){% endif %};
                    padding: 12px 18px;
                    border-radius: 18px;
                    max-width: 70%;
                    box-shadow: var(--shadow-sm);
                    {% if msg.user != user %}border-top-left-radius: 4px;{% else %}border-top-right-radius: 4px;{% endif %}
                ">
                    <div style="font-weight: 600; font-size: 13px; opacity: 0.9; margin-bottom: 4px;">
                        {{ msg.user.username }}
                        <span style="font-weight: normal; font-size: 12px; margin-left: 8px;">
                            {{ msg.timestamp|date:"H:i" }}
                        </span>
                    </div>
                    <div>{{ msg.content }}</div>
                </div>
            </div>
        {% empty %}
            <p style="text-align: center; color: #94a3b8; font-style: italic;">Пока нет сообщений. Напишите первое!</p>
        {% endfor %}
    </div>

    <form method="post" style="display: flex; gap: 12px;">
        {% csrf_token %}
        <input type="text" name="content" placeholder="Напишите сообщение..." required
               style="flex: 1; padding: 14px 18px; font-size: 16px; border: 1.5px solid var(--border-color); border-radius: 24px; background: #fafafa;">
        <button type="submit" class="btn" style="padding: 14px 24px; border-radius: 24px;">
            Отправить
        </button>
    </form>
</div>

<script>
    setTimeout(() => location.reload(), 5000);
</script>
{% endblock %}